<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <style type="text/css">
    /* ========== PAGE SETUP (Chromium PDF uyumlu) ========== */
    @page{
      size: A4 landscape;
      margin: 0;
      /* Chromium genelde @bottom-right desteklemez ama VF ile aynı dursun diye bırakıyorum */
      @bottom-right{
        content: counter(page);
        font-size: 9pt;
        color: #000;
        padding-right: 10mm;
      }
    }

    html, body{
      margin:0;
      padding:0;
      font-family:'Arial Unicode MS', Arial, 'Helvetica Neue', sans-serif;
      font-size:10pt;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    /* Her PDF sayfasını “container” gibi yönetiyoruz */
    .page{
      width: 297mm;
      height: 210mm;
      position: relative;
      page-break-after: always;
      overflow: hidden;
    }

    /* VF’de ilk sayfada background yok */
    .page.cover .page-bg{ display:none; }

    /* VF’de @page background-image yerine: her sayfaya background layer */
    .page-bg{
      position:absolute;
      inset:0;
      z-index:0;
      {{#if bgImage}}
      background-image:url('data:image/jpeg;base64,{{bgImage}}');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      {{/if}}
    }

    /* VF margin-top/bottom: 3cm => padding ile simüle */
    .page-content{
      position: relative;
      z-index: 1;
      height: 100%;
      box-sizing: border-box;
      padding-top: 30mm;     /* 3cm */
      padding-bottom: 30mm;  /* 3cm */
      padding-left: 0;
      padding-right: 0;
    }

    /* ========== VF CSS (birebir) ========== */
    .page-wrapper{
      width:250mm;
      margin:0mm auto 0mm auto;
    }

    .mrBlockOuter{
      width:100%;
      border-collapse:collapse;
    }

    .mrGreyWrapper{
      width:100%;
      border-collapse:collapse;
      background:#f7f7f7;
      border:1px solid #e0e0e0;
      padding:8px;
      margin:0 auto 0px auto;
    }

    .mrInnerWhite{
      width:100%;
      border-collapse:collapse;
      border:1px solid #999;
      background:#ffffff;
    }

    .mrInnerCell{
      padding:0px 12px 0px 12px;
    }

    .mrRoleTitle{
      font-size:17pt;
      text-align:left;
      margin:0;
      font-weight:700;
    }

    .mrCommentBox{
      border:0;
      padding:0px;
      min-height:12mm;
      font-size:12pt;
    }

    .mrCommentTitle{
      font-size:13pt;
      margin-bottom:0px;
      font-weight:700;
    }

    .mrCommentBody{
      text-align:left;
      word-wrap:break-word;
      font-size:12pt;
      line-height:1.2;
    }

    /* VF’deki optimize target */
    .mrCommentBody p,
    .mrCommentBody div,
    .mrCommentBody span,
    .mrCommentBody li,
    .mrCommentBody td,
    .mrCommentBody th{
      font-size:12pt !important;
      line-height:1.2 !important;
    }

    /* Rich text tabloları (çizgiler birebir) */
    .mrCommentBody table,
    .mrCommentBody th,
    .mrCommentBody td{
      border:1px solid #000 !important;
      border-collapse:collapse !important;
    }

    /* Rich text içindeki table width sapıtmalarını engelle */
    .mrCommentBody table{
      width: 100% !important;
    }
    .mrCommentBody td, .mrCommentBody th{
      padding: 4px 6px !important;
      vertical-align: top;
    }

    img{
      max-width:100%;
      height:auto;
    }

    .mrCommentBody img{
      max-width:100% !important;
      height:auto !important;
      display:block;
      margin:0px auto;
      text-align:center;
    }

    /* ✅ sadece img wrapper'a nobreak */
    .img-nobreak{
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .img-nobreak img{
      display:block;
      max-width:100% !important;
      height:auto !important;
    }

    /* Title sayfaları */
    .title-page{
      margin-top:6.5cm;
      margin-bottom:0px;
      padding:0;
    }
    .title-page-table{
      width:100%;
      height:100%;
      border-collapse:collapse;
    }
    .title-page-cell{
      vertical-align:middle;
      text-align:center;
      font-size:26pt;
      font-weight:700;
    }

    /* küçük yardımcı */
    .center { text-align:center; }
  </style>
</head>

<body>

  <!-- ================= KAPAK (arka plan yok) ================= -->
  <div class="page cover">
    <div class="page-content">
      <div class="page-wrapper">
        <table class="mrBlockOuter">
          <tr>
            <td style="padding-top:0mm;">

              <table style="width:100%" cellspacing="0" cellpadding="0">
                <tr>
                  <td align="center">
                    {{#if logoWood}}
                      <img src="data:image/png;base64,{{logoWood}}" width="650"/>
                    {{/if}}
                  </td>
                </tr>
              </table>

              <table style="width:100%;" cellspacing="0" cellpadding="0">
                <tr>
                  <td style="font-size:11pt;">
                    {{reportTitle}}
                  </td>
                </tr>
              </table>

            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>


  <!-- ================= DİREKTÖR: Title sayfası ================= -->
  {{#if hasDirectorComments}}
    <div class="page">
      <div class="page-bg"></div>
      <div class="page-content">
        <div class="page-wrapper">
          <div class="title-page" style="height:100%;">
            <table class="title-page-table" cellspacing="0" cellpadding="0">
              <tr>
                <td class="title-page-cell">
                  {{#if (eq channel "Export")}}
                    Yurt Dışı Satış Değerlendirme
                  {{else}}
                    Yurt İçi Satış Değerlendirme
                  {{/if}}
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Direktör yorumları: her biri ayrı sayfa -->
    {{#each directorComments}}
      <div class="page">
        <div class="page-bg"></div>
        <div class="page-content">
          <div class="page-wrapper">
            <table class="mrBlockOuter">
              <tr>
                <td>
                  <table class="mrGreyWrapper" cellspacing="0" cellpadding="0">
                    <tr>
                      <td>
                        <table class="mrInnerWhite" cellspacing="0" cellpadding="0">
                          <tr>
                            <td class="mrInnerCell">

                              <table style="width:100%; margin-top:0px;" cellspacing="0" cellpadding="0">
                                <tr>
                                  <td class="mrCommentBox">
                                    <div class="mrCommentTitle">{{title}}</div>
                                    <div class="mrCommentBody">
                                      {{{comment}}}
                                    </div>
                                  </td>
                                </tr>
                              </table>

                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    {{/each}}
  {{/if}}


  <!-- ================= GRUP MÜDÜRLÜĞÜ: Title sayfası ================= -->
  {{#if hasGroupManagerComments}}
    <div class="page">
      <div class="page-bg"></div>
      <div class="page-content">
        <div class="page-wrapper">
          <div class="title-page" style="height:100%;">
            <table class="title-page-table" cellspacing="0" cellpadding="0">
              <tr>
                <td class="title-page-cell">
                  {{weeklySalesReviewTitle}}
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Grup müdürlüğü yorumları: her biri ayrı sayfa -->
    {{#each groupManagerComments}}
      <div class="page">
        <div class="page-bg"></div>
        <div class="page-content">
          <div class="page-wrapper">
            <table class="mrBlockOuter">
              <tr>
                <td>

                  <div class="mrRoleTitle">
                    {{#if (eq ../channel "Export")}}Group Management{{else}}Grup Müdürlüğü{{/if}}
                  </div>

                  <table class="mrGreyWrapper" cellspacing="0" cellpadding="0">
                    <tr>
                      <td>
                        <table class="mrInnerWhite" cellspacing="0" cellpadding="0">
                          <tr>
                            <td class="mrInnerCell">

                              <table style="width:100%; margin-top:0px;" cellspacing="0" cellpadding="0">
                                <tr>
                                  <td class="mrCommentBox">
                                    <div class="mrCommentTitle">{{title}}</div>
                                    <div class="mrCommentBody">
                                      {{{comment}}}
                                    </div>
                                  </td>
                                </tr>
                              </table>

                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>

                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    {{/each}}
  {{/if}}


  <!-- ================= BÖLGE: Title sayfası ================= -->
  {{#if hasRegionalManagerComments}}
    <div class="page">
      <div class="page-bg"></div>
      <div class="page-content">
        <div class="page-wrapper">
          <div class="title-page" style="height:100%;">
            <table class="title-page-table" cellspacing="0" cellpadding="0">
              <tr>
                <td class="title-page-cell">
                  {{weeklySalesReviewTitle}}
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Bölge grupları -->
    {{#each regionalComments}}
      {{!-- VF mantığına yakın: her item ayrı sayfa, group başlığı sadece ilk sayfada gösterilebilir --}}
      {{#each items}}
        <div class="page">
          <div class="page-bg"></div>
          <div class="page-content">
            <div class="page-wrapper">

              <table class="mrBlockOuter">
                <tr>
                  <td>

                    {{#if @first}}
                      <div class="mrRoleTitle">
                        {{#if (eq ../../channel "Export")}}Regional Manager{{else}}Bölge Müdürü{{/if}}
                      </div>

                      <div class="mrCommentTitle" style="margin-top:0px;">
                        {{../groupTitle}}
                      </div>
                    {{/if}}

                    <table class="mrGreyWrapper" cellspacing="0" cellpadding="0">
                      <tr>
                        <td>
                          <table class="mrInnerWhite" cellspacing="0" cellpadding="0">
                            <tr>
                              <td class="mrInnerCell">

                                <table style="width:100%; margin-top:0px;" cellspacing="0" cellpadding="0">
                                  <tr>
                                    <td class="mrCommentBox">

                                      {{!-- Aynı title ise tekrar basma (VF) --}}
                                      {{#unless (eq title ../groupTitle)}}
                                        <div class="mrCommentTitle">{{title}}</div>
                                      {{/unless}}

                                      <div class="mrCommentBody">
                                        {{{comment}}}
                                      </div>

                                    </td>
                                  </tr>
                                </table>

                              </td>
                            </tr>
                          </table>
                        </td>
                      </tr>
                    </table>

                  </td>
                </tr>
              </table>

            </div>
          </div>
        </div>
      {{/each}}
    {{/each}}
  {{/if}}


  <!-- ================= KAPANIŞ (logoText) ================= -->
  {{#if hasAnyComments}}
    <div class="page">
      <div class="page-bg"></div>
      <div class="page-content">
        <div class="page-wrapper">
          <table class="mrBlockOuter">
            <tr>
              <td>
                <table style="width:100%" cellspacing="0" cellpadding="0">
                  <tr>
                    <td align="center">
                      {{#if logoText}}
                        <img src="data:image/png;base64,{{logoText}}" width="650"/>
                      {{/if}}
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  {{/if}}

</body>
</html>
